
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Last Layer</title>
  <style>
    body { background: #111; color: #eee; font-family: 'Georgia', serif; text-align: center; margin: 0; }
    #scene { width: 100%; max-width: 600px; height: auto; display: block; margin: 0 auto; }
    .btn { margin: 8px; padding: 10px 18px; background: #333; color: #fff; border: none; border-radius: 6px; font-size: 1.2rem; }
    .log, .inventory, .skills {
      background: rgba(255, 255, 255, 0.08);
      padding: 10px;
      margin: 10px auto;
      max-width: 700px;
      border-radius: 8px;
      font-size: 1.1rem;
    }
    #distance { margin: 10px; font-size: 1.2rem; color: #aaa; }
  </style>
</head>
<body>
  <h1>Last Layer</h1>
  <div id="distance">現在地：0m</div>
  <img id="scene" src="fork.png" alt="scene" />
  <div class="log" id="log">冒険を始めよう。</div>
  <div>
    <button class="btn" onclick="stepForward()">進む</button>
    <button class="btn" onclick="showItems()">アイテム</button>
    <button class="btn" onclick="showSkills()">スキル</button>
    <button class="btn" onclick="attackEnemy()">攻撃</button>
  </div>
  <script>
    const state = {
      hp: 20, mp: 10, attack: 5, magic: 3, defense: 3, magicDefense: 2,
      inventory: ["ショートソード", "ポーション"],
      skills: ["ファイアボール", "ヒール"],
      distance: 0,
      battle: false,
      enemy: null,
    };

    const enemies = [
      { name: "影", hp: 12, attack: 4, img: "enemy.png" }
    ];

    function log(msg) {
      document.getElementById("log").innerHTML = msg;
    }

    function updateDistance() {
      document.getElementById("distance").innerText = `現在地：${state.distance}m`;
    }

    function stepForward() {
      state.distance += 50;
      updateDistance();
      if (Math.random() < 0.5) {
        const enemy = JSON.parse(JSON.stringify(enemies[0]));
        state.enemy = enemy;
        state.battle = true;
        document.getElementById("scene").src = enemy.img;
        log(`${enemy.name} が現れた！`);
      } else {
        log("通路を進んだ……");
      }
    }

    function attackEnemy() {
      if (!state.battle || !state.enemy) return;
      const damage = state.attack;
      state.enemy.hp -= damage;
      log(`あなたの攻撃！${state.enemy.name} に ${damage} ダメージ！`);

      if (state.enemy.hp <= 0) {
        log(`${state.enemy.name} を倒した！`);
        state.battle = false;
        document.getElementById("scene").src = "fork.png";
      } else {
        setTimeout(enemyAttack, 600);
      }
    }

    function enemyAttack() {
      const damage = state.enemy.attack;
      state.hp -= damage;
      log(`${state.enemy.name} の攻撃！あなたは ${damage} ダメージを受けた！`);
      if (state.hp <= 0) {
        log("あなたは倒れた……GAME OVER");
        state.battle = false;
      }
    }

    function showItems() {
      let output = '<div class="inventory">アイテム:<br>';
      for (let item of state.inventory) {
        output += `<button class="btn" onclick="useItem('${item}')">${item}</button> `;
      }
      output += '</div>';
      log(output);
    }

    function useItem(item) {
      if (item === "ポーション") {
        state.hp = 20;
        state.inventory = state.inventory.filter(i => i !== item);
        log("ポーションでHPを全回復！");
      } else {
        log(`${item} は使えません。`);
      }
    }

    function showSkills() {
      let output = '<div class="skills">スキル:<br>';
      for (let skill of state.skills) {
        output += `<button class="btn" onclick="useSkill('${skill}')">${skill}</button> `;
      }
      output += '</div>';
      log(output);
    }

    function useSkill(skill) {
      if (skill === "ヒール" && state.mp >= 3) {
        state.hp = 20;
        state.mp -= 3;
        log("ヒールでHPを回復！");
      } else if (skill === "ファイアボール" && state.mp >= 5 && state.enemy) {
        const damage = 8;
        state.enemy.hp -= damage;
        state.mp -= 5;
        log(`ファイアボールで ${state.enemy.name} に ${damage} ダメージ！`);
        if (state.enemy.hp <= 0) {
          log(`${state.enemy.name} を倒した！`);
          state.battle = false;
          document.getElementById("scene").src = "fork.png";
        } else {
          setTimeout(enemyAttack, 600);
        }
      } else {
        log("条件を満たしていないかMPが不足しています。");
      }
    }
  </script>
</body>
</html>
