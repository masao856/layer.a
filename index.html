
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Last Layer - 通路から戦闘</title>
  <style>
    body {
      margin: 0;
      background-color: #000;
      color: #eee;
      font-family: 'Georgia', serif;
      text-align: center;
    }
    img {
      max-width: 100%;
      height: auto;
      display: block;
    }
    .btn {
      width: 80%;
      margin: 12px auto;
      padding: 15px;
      font-size: 1.2em;
      font-weight: bold;
      background: linear-gradient(#333, #111);
      color: #f0f0f0;
      border: 1px solid #666;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(255,255,255,0.1);
      transition: all 0.2s ease;
    }
    .btn:hover {
      background: #444;
      transform: scale(1.02);
    }
    .btn:active {
      background: #222;
    }
    .combat-area {
      position: relative;
      max-width: 800px;
      margin: 0 auto;
    }
    .combat-area img {
      width: 100%;
      height: auto;
    }
    .entity {
      position: absolute;
      max-width: 30%;
    }
    #player { left: 5%; bottom: 5%; }
    #enemy { right: 5%; bottom: 5%; }
    .weapon { left: 15%; bottom: 0%; max-width: 12%; position: absolute; }
    #stats, #log {
      padding: 14px;
      background: rgba(0, 0, 0, 0.75);
      margin-top: 5px;
    }
    #log {
      font-style: italic;
      color: #ccc;
      min-height: 50px;
    }
  </style>
</head>
<body>

<!-- 通路選択画面 -->
<div id="stage1">
  <img src="fork.png" alt="通路">
  <p>あなたの前には分かれ道がある。どちらへ進む？</p>
  <button class="btn" onclick="enterBattle()">左に進む</button>
  <button class="btn" onclick="enterBattle()">右に進む</button>
</div>

<!-- 戦闘画面 -->
<div id="stage2" style="display:none;">
  <div class="combat-area">
    <img src="background.png" alt="戦闘背景">
    <img id="player" class="entity" src="character.png" alt="プレイヤー">
    <img id="enemy" class="entity" src="enemy.png" alt="敵">
    <img class="weapon" src="sword.png" alt="武器">
  </div>

  <div id="stats">
    プレイヤーHP: <span id="playerHP">30</span> / 敵HP: <span id="enemyHP">25</span>
  </div>
  <div id="log">……何かがこちらを見ている。</div>
  <button class="btn" onclick="attack()">攻撃</button>
  <button class="btn" onclick="skill()">スキル</button>
  <button class="btn" onclick="defend()">防御</button>
  <button class="btn" onclick="escape()">逃げる</button>
</div>

<script>
  let playerHP = 30;
  let enemyHP = 25;
  let exp = 0;
  let skillUsed = false;
  let defending = false;
  let defeated = false;

  function enterBattle() {
    document.getElementById("stage1").style.display = "none";
    document.getElementById("stage2").style.display = "block";
  }

  function updateStats() {
    document.getElementById('playerHP').textContent = playerHP;
    document.getElementById('enemyHP').textContent = enemyHP;
  }

  function log(msg) {
    document.getElementById('log').textContent = msg;
  }

  function endBattle(victory) {
    defeated = true;
    if (victory) {
      let gainedExp = Math.floor(Math.random() * 10) + 15;
      exp += gainedExp;
      log("勝利した……。 経験値 +" + gainedExp + " を獲得！");
    } else {
      log("……視界が闇に染まっていく。あなたは敗北した。");
    }
  }

  function enemyAttack() {
    if (enemyHP <= 0 || playerHP <= 0 || defeated) return;
    let dmg = Math.floor(Math.random() * 4) + 3;
    if (defending) {
      dmg = Math.floor(dmg / 2);
      defending = false;
    }
    playerHP -= dmg;
    if (playerHP <= 0) {
      playerHP = 0;
      updateStats();
      endBattle(false);
    } else {
      log("喰らうものの攻撃！ -" + dmg + " HP");
      updateStats();
    }
  }

  function attack() {
    if (enemyHP <= 0 || playerHP <= 0 || defeated) return;
    let dmg = Math.floor(Math.random() * 4) + 5;
    enemyHP -= dmg;
    if (enemyHP <= 0) {
      enemyHP = 0;
      updateStats();
      endBattle(true);
    } else {
      log("あなたは攻撃した！ -" + dmg + " HP");
      updateStats();
      setTimeout(enemyAttack, 1000);
    }
  }

  function skill() {
    if (skillUsed || defeated) {
      log("スキルはもう使えない！");
      return;
    }
    skillUsed = true;
    let dmg = Math.floor(Math.random() * 6) + 10;
    enemyHP -= dmg;
    if (enemyHP <= 0) {
      enemyHP = 0;
      updateStats();
      endBattle(true);
    } else {
      log("奥義を発動！ -" + dmg + " HP");
      updateStats();
      setTimeout(enemyAttack, 1000);
    }
  }

  function defend() {
    if (defeated) return;
    defending = true;
    log("防御姿勢をとった！");
    setTimeout(enemyAttack, 1000);
  }

  function escape() {
    if (defeated) return;
    if (Math.random() < 0.4) {
      log("あなたは闇へ逃げ切った……。");
      defeated = true;
    } else {
      log("逃げられない！");
      setTimeout(enemyAttack, 1000);
    }
  }
</script>

</body>
</html>
