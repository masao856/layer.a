
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Last Layer - Prototype</title>
    <style>
        body {
            background-color: #111;
            color: #eee;
            font-family: "游ゴシック", sans-serif;
            text-align: center;
        }
        .image-row {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 20px;
        }
        img {
            max-height: 250px;
        }
        button {
            background-color: #333;
            color: white;
            font-size: 1.2em;
            padding: 10px 30px;
            margin: 10px;
            border: none;
            border-radius: 6px;
        }
        .log {
            margin: 20px;
            font-size: 1.1em;
        }
    </style>
</head>
<body>
    <h1>Last Layer</h1>
    <div id="stage">
        <img src="fork.png" id="background" style="width: 100%;">
        <button onclick="startBattle()">進む</button>
    </div>
    <script>
        let battleCount = 0;
        let playerHP = 20;
        let enemyHP = 10;
        let sword = "short";
        let inventory = [];

        function startBattle() {
            const stage = document.getElementById("stage");
            stage.innerHTML = `
                <div class="image-row">
                    <img src="character.png" id="playerImg">
                    <img src="${getEnemyImage()}" id="enemyImg">
                </div>
                <div class="log" id="status">プレイヤーHP: ${playerHP} / 敵HP: ${enemyHP}</div>
                <button onclick="attack()">攻撃</button>
                <button onclick="skill()">スキル</button>
                <button onclick="heal()">アイテム</button>
            `;
        }

        function getEnemyImage() {
            if (battleCount === 0) return "enemy.png";
            if (battleCount === 1) return "armor_enemy_midboss_final.png";
            return "fallen_king_final.png";
        }

        function attack() {
            const damage = sword === "long" ? 7 : 5;
            enemyHP -= damage;
            if (enemyHP <= 0) {
                victory();
            } else {
                enemyAttack();
            }
            updateStatus();
        }

        function skill() {
            enemyHP -= 4;
            enemyAttack();
            updateStatus();
        }

        function heal() {
            if (inventory.includes("potion")) {
                playerHP += 10;
                inventory = inventory.filter(item => item !== "potion");
            }
            enemyAttack();
            updateStatus();
        }

        function enemyAttack() {
            playerHP -= 3;
            if (playerHP <= 0) {
                document.getElementById("stage").innerHTML = "<h2>敗北…</h2>";
            }
        }

        function victory() {
            const stage = document.getElementById("stage");
            let rewardText = "";
            if (battleCount === 0) {
                rewardText = "ロングソードを入手！装備しますか？<br><button onclick='equipLongSword()'>はい</button><button onclick='nextBattle()'>いいえ</button>";
            } else if (battleCount === 1) {
                inventory.push("potion");
                rewardText = "ポーションを入手！<br><button onclick='nextBattle()'>次へ</button>";
            } else {
                stage.innerHTML = "<h2>すべての敵を倒した！勝利！</h2>";
                return;
            }
            stage.innerHTML = "<div class='log'>敵を倒した！</div>" + rewardText;
        }

        function equipLongSword() {
            sword = "long";
            nextBattle();
        }

        function nextBattle() {
            battleCount++;
            enemyHP = battleCount === 2 ? 20 : 12;
            startBattle();
        }

        function updateStatus() {
            document.getElementById("status").innerText = `プレイヤーHP: ${playerHP} / 敵HP: ${enemyHP}`;
        }
    </script>
</body>
</html>
