
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Last Layer - 通路から戦闘へ</title>
  <style>
    body {
      margin: 0;
      background-color: #000;
      color: #fff;
      font-family: 'Georgia', serif;
      text-align: center;
    }
    img {
      max-width: 100%;
      height: auto;
      display: block;
    }
    .btn {
      width: 90%;
      margin: 10px auto;
      padding: 15px;
      font-size: 1.2em;
      background: #444;
      color: white;
      border: none;
      border-radius: 6px;
    }
    .btn:active {
      background: #666;
    }
    .combat-area {
      position: relative;
    }
    .entity {
      position: absolute;
      max-width: 35%;
    }
    #player {
      left: 5%;
      bottom: 10%;
    }
    #enemy {
      right: 5%;
      bottom: 10%;
    }
    .weapon {
      position: absolute;
      left: 15%;
      bottom: 5%;
      max-width: 15%;
    }
    #stats, #log {
      padding: 10px;
      background: rgba(0,0,0,0.8);
    }
  </style>
</head>
<body>

<div id="stage1">
  <img src="fork.png" alt="通路" />
  <p>あなたの前には分かれ道がある。どちらへ進む？</p>
  <button class="btn" onclick="enterBattle()">左の道へ進む</button>
  <button class="btn" onclick="enterBattle()">右の道へ進む</button>
</div>

<div id="stage2" style="display:none;">
  <div class="combat-area">
    <img src="background.png" alt="戦闘背景" />
    <img id="player" class="entity" src="character.png" alt="プレイヤー" />
    <img id="enemy" class="entity" src="enemy.png" alt="敵" />
    <img class="weapon" src="sword.png" alt="ショートソード" />
  </div>
  <div id="stats">
    プレイヤーHP: <span id="playerHP">30</span> / 敵HP: <span id="enemyHP">25</span>
  </div>
  <div id="log">「喰らうもの」が現れた……。</div>
  <button class="btn" onclick="attack()">攻撃</button>
  <button class="btn" onclick="skill()">スキル</button>
  <button class="btn" onclick="defend()">防御</button>
  <button class="btn" onclick="escape()">逃げる</button>
</div>

<script>
  let playerHP = 30;
  let enemyHP = 25;
  let skillUsed = false;
  let defending = false;

  function enterBattle() {
    document.getElementById("stage1").style.display = "none";
    document.getElementById("stage2").style.display = "block";
  }

  function updateStats() {
    document.getElementById('playerHP').textContent = playerHP;
    document.getElementById('enemyHP').textContent = enemyHP;
  }

  function log(msg) {
    document.getElementById('log').textContent = msg;
  }

  function enemyAttack() {
    if (enemyHP <= 0 || playerHP <= 0) return;
    let dmg = Math.floor(Math.random() * 4) + 3;
    if (defending) {
      dmg = Math.floor(dmg / 2);
      defending = false;
    }
    playerHP -= dmg;
    if (playerHP <= 0) {
      playerHP = 0;
      log("喰らうものの攻撃であなたは倒れた……。");
    } else {
      log("喰らうものの攻撃！ " + dmg + " のダメージ！");
    }
    updateStats();
  }

  function attack() {
    if (enemyHP <= 0 || playerHP <= 0) return;
    let dmg = Math.floor(Math.random() * 4) + 5;
    enemyHP -= dmg;
    if (enemyHP <= 0) {
      enemyHP = 0;
      log("あなたの攻撃が決まり、喰らうものは崩れ落ちた！");
    } else {
      log("あなたは攻撃した！ " + dmg + " のダメージ！");
      setTimeout(enemyAttack, 1000);
    }
    updateStats();
  }

  function skill() {
    if (skillUsed) {
      log("スキルはもう使えない！");
      return;
    }
    skillUsed = true;
    let dmg = Math.floor(Math.random() * 6) + 10;
    enemyHP -= dmg;
    if (enemyHP <= 0) {
      enemyHP = 0;
      log("あなたのスキルが炸裂し、喰らうものは絶命した！");
    } else {
      log("あなたはスキルを放った！ " + dmg + " の大ダメージ！");
      setTimeout(enemyAttack, 1000);
    }
    updateStats();
  }

  function defend() {
    defending = true;
    log("あなたは防御の構えを取った！");
    setTimeout(enemyAttack, 1000);
  }

  function escape() {
    if (Math.random() < 0.4) {
      log("あなたは闇の中へ逃げ切った！");
    } else {
      log("逃げようとしたが、影が行く手を阻む！");
      setTimeout(enemyAttack, 1000);
    }
  }
</script>
</body>
</html>
